name: Morse Code Time Update  # ì›Œí¬í”Œë¡œìš° ì´ë¦„ ì •ì˜

on:
  schedule:
    - cron: "*/6 * * * *"  # 6ë¶„ë§ˆë‹¤ ìë™ ì‹¤í–‰
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥

permissions:
  contents: write  # ë¦¬í¬ì§€í† ë¦¬ íŒŒì¼ ìˆ˜ì • ê¶Œí•œ ë¶€ì—¬

jobs:
  morse-time:
    runs-on: ubuntu-latest  # ìµœì‹  Ubuntu í™˜ê²½ì—ì„œ ì‹¤í–‰

    steps:
      - name: Checkout repository  # 1ï¸âƒ£ ë¦¬í¬ì§€í† ë¦¬ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
        uses: actions/checkout@v4

      - name: Install g++  # 2ï¸âƒ£ C++ ì»´íŒŒì¼ëŸ¬ ì„¤ì¹˜
        run: sudo apt-get update && sudo apt-get install -y g++

      - name: Build morse_code.cpp  # 3ï¸âƒ£ morse_code.cpp ì»´íŒŒì¼
        run: g++ morse_code.cpp -o morse_code

      - name: Get current date and time (KST) and save to file  # 4ï¸âƒ£ ì˜¤ëŠ˜ ë‚ ì§œì™€ ì‹œê°„ ì €ì¥
        run: |
          TZ=Asia/Seoul date +"%Y-%m-%d" > current_date.txt   # ì˜¤ëŠ˜ ë‚ ì§œ (ì˜ˆ: 2025-10-06)
          TZ=Asia/Seoul date +"%H:%M" > current_time.txt      # í˜„ì¬ ì‹œê°„ (ì˜ˆ: 14:36)

      - name: Run morse_code.cpp to convert time to Morse code  # 5ï¸âƒ£ ëª¨ìŠ¤ ì½”ë“œ ë³€í™˜ ì‹¤í–‰
        run: |
          ./morse_code < current_time.txt > morse_output.txt

      - name: Update README.md with date, time, and Morse code  # 6ï¸âƒ£ README ì—…ë°ì´íŠ¸
        run: |
          CURRENT_DATE=$(cat current_date.txt)   # ì˜¤ëŠ˜ ë‚ ì§œ ì½ê¸°
          CURRENT_TIME=$(cat current_time.txt)   # í˜„ì¬ ì‹œê°„ ì½ê¸°
          MORSE_CODE=$(cat morse_output.txt)     # ëª¨ìŠ¤ ì½”ë“œ ê²°ê³¼ ì½ê¸°

          # awkë¡œ READMEì˜ íŠ¹ì • ì˜ì—­ë§Œ êµì²´
          awk -v d="$CURRENT_DATE" -v t="$CURRENT_TIME" -v m="$MORSE_CODE" '
            BEGIN {s=0}
            /<!-- MORSE_TIME_START -->/ {
              print;
              print "ğŸ—“ï¸ **" d "** | â° **" t " (KST)**\n\n```\n" m "\n```";
              s=1; next
            }
            /<!-- MORSE_TIME_END -->/ {s=0}
            s==0 {print}
          ' README.md > README.tmp && mv README.tmp README.md

      - name: Commit and push if README.md changed  # 7ï¸âƒ£ README ë³€ê²½ ì‹œ ì»¤ë°‹ ë° í‘¸ì‹œ
        run: |
          git config --local user.name "github-actions[bot]"
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git diff --cached --quiet || git commit -m "Update Morse code time in README [bot]"
          git pull --rebase origin ${{ github.ref_name }}
          git push origin ${{ github.ref_name }}
